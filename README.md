### Metamn

The source code for http://metamn.io and the associated Styleguide http://metamn.io/styleguide.

A short introduction how use Gulp to create the Styleguide can be found on Medium: https://medium.com/@metamn/creating-a-styleguide-with-gulp-2298fc928086

Here we will get all the details how everything was made.

### Technologies

* Gulp &mdash; for generating the site and the styleguide
* JSON &mdash; file database
* BEM &mdash; folder structure and naming conventions, together with a generator
* SWIG &mdash; templating language
* SCSS &mdash; style pre-processor
* JS &mdash; all animations except touch events
* Picturefill &mdash; for responsive images
* KSS &mdash; for documentation
* Flexbox &mdash; for the layout
* Automatic image resize and compression
* A Styleguide in sync with the site


### Installation and usage

1. Clone the repository
2. Install all packages from `package.json` with `[sudo] npm install`
3. Generate the site: `gulp`
4. Generate the styleguide `gulp sg`
5. Resize, compress images: `gulp images`



### Folders and files

We have two sites, one for the portfolio with source files in `site`, and one for
the Styleguide with source files in `styleguide`.
The Styleguide is optional. It can be completely ignored.

The generated files can be found in `dist`. The Styleguide is mounted under `dist\styleguide`
for simplicity.

`bem.js` is generating BEM folders, blocks, elements and modifiers.

`gulpfile.js` contains all the generators and glues making the site.



#### BEM

We use BEM to create the folder structure (https://en.bem.info/method/filesystem/) and name files and classes (https://en.bem.info/method/definitions/).

In `components/framework` we use an explicit folder structure as follows:

* `behavior` &mdash; everything related to motion, animation
* `design` &mdash; everything related to design like colors, fonts, decorations
* `helpers` &mdash; SWIG helpers used across the site and the styleguide
* `structure` &mdash; everything related to structure like the grid, the responsive images, breakpoints etc.


#### In the Styleguide

All styleguide entries are in the `styleguide/components/pages` folder.
The `styleguide/components/framework` and `styleguide/components/project` folders are containing
components used to create the styleguide.


### Gulp

* We have just a single Gulpfile handling all tasks. Later this will be refactored into separate modules.
* Extensive documentation is added to each gulp task and function
* Due to the async nature of gulp sometimes a major task&mdash;generate the site, the styleguide and the images&mdash; has to be run more than once to get the desired final result.
* For this reason I don't really use the `gulp watch` task. I do compile manually what was changed.
* The best way to learn how each task works is to run them individually and uncomment/add the console logs.


#### Plugins

* All of them are needed
* Also the plugins used by `bem.js` are listed here
* Plugins are grouped for better understanding


#### Paths

* We have a single section for path definitions
* As we generate two sites, the main site and the styleguide, we usually have definitions for both of them


#### Images

* All images go into the `site/assets/images` folder at their original, largest size.
* Every image has associated a same name JSON file. `anvelocom-archive-laptop.png` pairs with `anvelocom-archive-laptop.json`.
* The JSON file contains responsive size declarations for various device sizes.
* The `gulp images` task resizes the original images to responsive sizes (with ImageMagick), compress them and moves all results to `site/assets/images/resized`.
* From this temporary directory images are moved to destination directory (`dist/assets/images`).
* Currently only `.png` images are compressed with `pngquant`. If you have a `.jpg` image make sure the already compressed version goes into `site/assets/images`.

#### JS

* Scripts found outside the `components` folder are moved as they are to the destination directory.
* Scripts inside `components` are all concatenated into `site.min.js` or `styleguide.min.js` and moved to the destination directory.


#### SCSS

* We have two files `site/assets/styles/site.scss` and `styleguide/assets/styles/styleguide.scss` which are importing all other SCSS mixins building the site.
* The `styleguide.scss` also imports all the mixins from `site`.
* These two files are autoprefixed, minimized and moved to the destination folder


#### HTML

* All `.html` files are generated by SWIG from the same name `.html.swig` counterparts. They are stored in the same folder they have been found.
* These `.html` files are like the `.scss` partials. They do not exist alone.
* The gulp script takes the top level `.html` files (ie. `components/pages/home/index.html`), makes them SEO friendly, compress them and copy to the destination folder


#### SWIG

* Any of the `.html`, `.scss`, `.js` files can have a same name counterpart file ending in `.swig` (ie. `fonts.scss.swig`).
* The gulp task compiles all these `.swig` files into their original format (ie. `fonts.scss`)
* If a source `.swig` file has a YAML Front-matter data the data is processed during the compilation
* If a source `.swig` file has a `.json` file associated the data in `.json` is processed during the compilation
* Site wide data from `config.json` is always processed during compilation
* `.json` from `site/` is made available to files in `styleguide/`. For example if we have a `site/components/framework/design/colors.scss.json` it will be made available for `styleguide/components/pages/framework/design/colors*.swig`. This way the Styleguide has access to all JSON declarations from `site/`.
* Site wide SCSS documentation created by KSS from `styleguide/kss.json` is made available for `.swig` files during the compilation



### Special Styleguide Tasks

#### Full Sync

* All content from `site/components` is synced with `styleguide/components/pages`. If new components are added to `site` they become present in `styleguide`. If a component is removed from `site` but still present in `styleguide` we will get a message on the console.
* `site/components/framework/pages` are the only exception. We don't have a styleguide entry for pages just for components.

#### Menu

* The menu for the Styleguide is generated by gulp
* Menu files are generated into `styleguide/components/project/styleguide-menu`

#### KSS

* All KSS documentation from `site/components/**/*.scss` are collected into a single file in `styleguide/kss.json`
* This JSON data is processed when creating styleguide entries
